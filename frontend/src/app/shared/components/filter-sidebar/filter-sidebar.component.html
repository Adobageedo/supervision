<!-- Backdrop -->
<div class="filter-backdrop" 
     [class.open]="isOpen" 
     (click)="close()"></div>

<!-- Sidebar -->
<div class="filter-sidebar" [class.open]="isOpen">
  <!-- Header -->
  <div class="sidebar-header">
    <h2>
      <mat-icon>filter_list</mat-icon>
      Filtres
    </h2>
    <button mat-icon-button (click)="close()" aria-label="Fermer">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Content -->
  <div class="sidebar-content">
    <!-- Date Range Section -->
    <div class="filter-section">
      <h3>Période</h3>
      
      <mat-button-toggle-group 
        [value]="timeRange" 
        (change)="onTimeRangeChange($event.value)"
        class="date-range-toggle"
        vertical>
        <mat-button-toggle value="last7days">
          7 derniers jours
        </mat-button-toggle>
        <mat-button-toggle value="last30days">
          30 derniers jours
        </mat-button-toggle>
        <mat-button-toggle value="currentMonth">
          Mois en cours
        </mat-button-toggle>
        <mat-button-toggle value="previousMonth">
          Mois précédent
        </mat-button-toggle>
        <mat-button-toggle value="custom">
          <mat-icon>date_range</mat-icon>
          Personnalisé
        </mat-button-toggle>
      </mat-button-toggle-group>

      <!-- Custom Date Picker -->
      @if (showCustomDatePicker) {
        <div class="custom-date-section">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Date de début</mat-label>
            <input matInput [matDatepicker]="startPicker" [formControl]="customStartDate">
            <mat-datepicker-toggle matIconSuffix [for]="startPicker"></mat-datepicker-toggle>
            <mat-datepicker #startPicker></mat-datepicker>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Date de fin</mat-label>
            <input matInput [matDatepicker]="endPicker" [formControl]="customEndDate">
            <mat-datepicker-toggle matIconSuffix [for]="endPicker"></mat-datepicker-toggle>
            <mat-datepicker #endPicker></mat-datepicker>
          </mat-form-field>

          <button mat-raised-button color="primary" 
                  (click)="applyCustomDateRange()" 
                  class="full-width">
            Appliquer les dates
          </button>
        </div>
      }
    </div>

    <mat-divider></mat-divider>

    <!-- Centrales Section -->
    <div class="filter-section">
      <h3>Centrales</h3>
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Sélectionner centrales</mat-label>
        <mat-select [(ngModel)]="selectedCentrales" 
                    multiple 
                    (selectionChange)="onCentraleSelectionChange()">
          @for (centrale of filteredCentrales; track centrale) {
            <mat-option [value]="centrale">{{ centrale }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
      
      @if (selectedCentrales.length > 0) {
        <div class="selected-chips">
          @for (centrale of selectedCentrales; track centrale) {
            <mat-chip (removed)="removeCentrale(centrale)">
              {{ centrale }}
              <button matChipRemove>
                <mat-icon>cancel</mat-icon>
              </button>
            </mat-chip>
          }
        </div>
      }
    </div>

    <mat-divider></mat-divider>

    <!-- Équipements Section -->
    <div class="filter-section">
      <h3>Équipements</h3>
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Sélectionner équipements</mat-label>
        <mat-select [(ngModel)]="selectedEquipements" 
                    multiple 
                    (selectionChange)="onEquipementSelectionChange()">
          @for (equipement of filteredEquipements; track equipement) {
            <mat-option [value]="equipement">{{ equipement }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
      
      @if (selectedEquipements.length > 0) {
        <div class="selected-chips">
          @for (equipement of selectedEquipements; track equipement) {
            <mat-chip (removed)="removeEquipement(equipement)">
              {{ equipement }}
              <button matChipRemove>
                <mat-icon>cancel</mat-icon>
              </button>
            </mat-chip>
          }
        </div>
      }
    </div>
  </div>

  <!-- Footer Actions -->
  <div class="sidebar-footer">
    <button mat-stroked-button (click)="resetFilters()" class="reset-btn">
      <mat-icon>refresh</mat-icon>
      Réinitialiser
    </button>
    <button mat-raised-button color="primary" (click)="applyFilters(); close()" class="apply-btn">
      <mat-icon>check</mat-icon>
      Appliquer
    </button>
  </div>
</div>
